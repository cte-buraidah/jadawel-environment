<script>
(function(){
  const listEl = document.getElementById('list');
  const searchEl = document.getElementById('search');
  const pdfObj = document.getElementById('pdfObj');
  const openNew = document.getElementById('openNew');
  const viewerTitle = document.getElementById('viewerTitle');
  const hint = document.getElementById('hint');

  // أسماء المدرّبين مرتبة، مع رقم الصفحة الخاص بكل مدرّب
  const trainers = [
    { n:1,  name:"محمد سليمان التويجري" },
    { n:2,  name:"ابراهيم عبدالله الجطيلي" },
    { n:3,  name:"احمد عبدالعزيز الخميس" },
    { n:4,  name:"عبدالله صالح السحيباني" },
    { n:5,  name:"عبدالله صالح السحيباني" }, // مكرر حسب قائمتك
    { n:6,  name:"وليد صالح اليحيى" },
    { n:7,  name:"يوسف محمد المشاري" },
    { n:8,  name:"علي صالح العثمان" },
    { n:9,  name:"صالح عبدالكريم المقبل" },
    { n:10, name:"فلاح سند الحربي" },
    { n:11, name:"صالح عويض الرشيدي" },
    { n:12, name:"دخيل الله جمعة الجمعة" },
    { n:13, name:"محمد رجاء الرشيدي" },
    { n:14, name:"عبدالعزيز سليمان الجبري" },
    { n:15, name:"محمد حمدان المطيري" },
    { n:16, name:"مبارك بن شمروخ" },
    { n:17, name:"هادي يحيى آل مشرف" },
    { n:18, name:"هادي يحيى آل مشرف" }, // مكرر حسب قائمتك
    { n:19, name:"محمد علي القفيعي" },
    { n:20, name:"محمد ابراهيم النقيدان" },
    { n:21, name:"عيسى فهد الشمري" },
    { n:22, name:"فهد عبدالله المقبل" }
  ];

  // دالة تفحص أي اسم ملف موجود فعلاً (تجرب الصيغ المحتملة)
  async function resolvePdfUrl(num){
    const pad2 = String(num).padStart(2,'0');
    const candidates = [
      `page-${pad2}.pdf`,
      `page-${num}.pdf`,
      `page-${pad2}.PDF`,
      `page-${num}.PDF`
    ];
    for(const url of candidates){
      try{
        const res = await fetch(url, { method:'HEAD', cache:'no-store' });
        if(res.ok) return url;
      }catch(_){}
    }
    // إن ما لقي شيء نرجّع أول اسم افتراضي (عشان على الأقل يظهر زر الفتح)
    return candidates[0];
  }

  function isIOS(){ return /iPad|iPhone|iPod/.test(navigator.userAgent); }

  function render(list){
    listEl.innerHTML = '';
    list.forEach(it=>{
      const el = document.createElement('div');
      el.className = 'trainer';
      el.innerHTML = `<div style="display:flex;align-items:center;gap:8px">
          <span class="dot"></span><div style="font-weight:700">${it.name}</div>
        </div><div style="opacity:.6">›</div>`;
      el.onclick = ()=> select(it);
      listEl.appendChild(el);
    });
  }

  async function select(it){
    viewerTitle.textContent = '📄 ' + it.name;
    // نحاول نلقى الاسم الصحيح للملف
    const url = await resolvePdfUrl(it.n);
    pdfObj.data = url;
    openNew.href = url;
    if(isIOS()){
      hint.style.display = 'block';
      // على iOS أحياناً العارض داخل الصفحة ما يشتغل، نخلي الزر موجود
    } else {
      hint.style.display = 'none';
    }
  }

  function filter(q){
    q = (q||'').trim();
    if(!q) return trainers;
    try{
      const rx = new RegExp(q.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'),'i');
      return trainers.filter(t=> rx.test(t.name));
    }catch(_){ return trainers; }
  }

  render(trainers);
  searchEl.oninput = ()=> render(filter(searchEl.value));
})();
</script>
